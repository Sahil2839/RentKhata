{% extends "base.html" %}
{% load humanize %}
{% block content %}

<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>All Bills</h2>
    {% if user.role == 'landlord' %}
      <form method="get" class="d-flex">
        <input type="text" name="tenant" placeholder="Filter by tenant" class="form-control me-2" value="{{ tenants_filter }}">
        <button class="btn btn-primary">Filter</button>
      </form>
    {% endif %}
  </div>

  {% if bills %}
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Tenant</th>
          <th>Period</th>
          <th>Rent</th>
          <th>Meter Bill</th>
          <th>Misc</th>
          <th>Total</th>
          <th>Paid</th>
          <th>Remaining</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for bill in bills %}
          <tr>
            <td>
              {% if bill.offline_tenant %}{{ bill.offline_tenant.name }}
              {% elif bill.online_tenant %}{{ bill.online_tenant.tenant.username }}
              {% endif %}
            </td>
            <td>{{ bill.start_date }} → {{ bill.end_date }}</td>
            <td>₹{{ bill.rent|intcomma }}</td>
            <td>₹{{ bill.meter_bill|intcomma }}</td>
            <td>₹{{ bill.misc_charge|intcomma }}</td>
            <td>₹{{ bill.total_bill_amount|intcomma }}</td>
            <td>₹{{ bill.amount_paid|intcomma }}</td>
            <td>₹{{ bill.remaining_due|intcomma }}</td>
            <td>{{ bill.get_status_display }}</td>
            <td>
              <a href="{% url 'bill_detail' bill.id %}" class="btn btn-sm btn-info">View</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-muted">No bills available.</p>
  {% endif %}
</div>

{% endblock %}
